function Editor(a){a=a||{},a.element&&(this.element=a.element),a.toolbar=a.toolbar||Editor.toolbar,a.hasOwnProperty("status")||(a.status=["lines","words","cursor"]),this.options=a,this.element&&this.render()}var toolbar=[{name:"bold",action:toggleBold},{name:"italic",action:toggleItalic},"|",{name:"quote",action:toggleBlockquote},{name:"unordered-list",action:toggleUnOrderedList},{name:"ordered-list",action:toggleOrderedList},"|",{name:"link",action:drawLink},{name:"image",action:drawImage},"|",{name:"info",action:"http://lab.lepture.com/editor/markdown"},{name:"preview",action:togglePreview},{name:"fullscreen",action:toggleFullScreen}];Editor.toolbar=toolbar,Editor.markdown=function(a){if(window.marked)return marked(a)},Editor.prototype.render=function(a){a||(a=this.element||document.getElementsByTagName("textarea")[0]);if(this._rendered&&this._rendered===a)return;this.element=a;var b=this.options,c=this,d={};for(var e in shortcuts)(function(a){d[fixShortcut(a)]=function(b){shortcuts[a](c)}})(e);d.Enter="newlineAndIndentContinueMarkdownList",this.codemirror=CodeMirror.fromTextArea(a,{mode:"markdown",theme:"paper",indentWithTabs:!0,lineNumbers:!1,extraKeys:d}),b.toolbar!==!1&&this.createToolbar(),b.status!==!1&&this.createStatusbar(),this._rendered=this.element},Editor.prototype.createToolbar=function(a){a=a||this.options.toolbar;if(!a||a.length===0)return;var b=document.createElement("div");b.className="editor-toolbar";var c=this,d;c.toolbar={};for(var e=0;e<a.length;e++)(function(a){var d;a.name?d=createIcon(a.name,a):a==="|"?d=createSep():d=createIcon(a),a.action&&(typeof a.action=="function"?d.onclick=function(b){a.action(c)}:typeof a.action=="string"&&(d.href=a.action,d.target="_blank")),c.toolbar[a.name||a]=d,b.appendChild(d)})(a[e]);var f=this.codemirror;f.on("cursorActivity",function(){var a=getState(f);for(var b in c.toolbar)(function(b){var d=c.toolbar[b];a[b]?d.className+=" active":d.className=d.className.replace(/\s*active\s*/g,"")})(b)});var g=f.getWrapperElement();return g.parentNode.insertBefore(b,g),b},Editor.prototype.createStatusbar=function(a){a=a||this.options.status;if(!a||a.length===0)return;var b=document.createElement("div");b.className="editor-statusbar";var c,d=this.codemirror;for(var e=0;e<a.length;e++)(function(a){var e=document.createElement("span");e.className=a,a==="words"?(e.innerHTML="0",d.on("update",function(){e.innerHTML=wordCount(d.getValue())})):a==="lines"?(e.innerHTML="0",d.on("update",function(){e.innerHTML=d.lineCount()})):a==="cursor"&&(e.innerHTML="0:0",d.on("cursorActivity",function(){c=d.getCursor(),e.innerHTML=c.line+":"+c.ch})),b.appendChild(e)})(a[e]);var f=this.codemirror.getWrapperElement();return f.parentNode.insertBefore(b,f.nextSibling),b},Editor.toggleBold=toggleBold,Editor.toggleItalic=toggleItalic,Editor.toggleBlockquote=toggleBlockquote,Editor.toggleUnOrderedList=toggleUnOrderedList,Editor.toggleOrderedList=toggleOrderedList,Editor.drawLink=drawLink,Editor.drawImage=drawImage,Editor.undo=undo,Editor.redo=redo,Editor.toggleFullScreen=toggleFullScreen,Editor.prototype.toggleBold=function(){toggleBold(this)},Editor.prototype.toggleItalic=function(){toggleItalic(this)},Editor.prototype.toggleBlockquote=function(){toggleBlockquote(this)},Editor.prototype.toggleUnOrderedList=function(){toggleUnOrderedList(this)},Editor.prototype.toggleOrderedList=function(){toggleOrderedList(this)},Editor.prototype.drawLink=function(){drawLink(this)},Editor.prototype.drawImage=function(){drawImage(this)},Editor.prototype.undo=function(){undo(this)},Editor.prototype.redo=function(){redo(this)},Editor.prototype.toggleFullScreen=function(){toggleFullScreen(this)};